<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Выбор даты</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
        }

        .calendar {
            max-width: 100%;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }

        .nav-button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 16px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .week-day {
            padding: 12px 8px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .week-day.weekend {
            color: #ff4444;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 20px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .day:hover {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }

        .day.selected {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .day.other-month {
            color: var(--tg-theme-hint-color, #cccccc);
        }

        .day.today {
            border-color: var(--tg-theme-button-color, #2481cc);
        }

        .day.weekend {
            color: #ff4444;
        }

        .day.weekend.other-month {
            color: #ffaaaa;
        }

        .selected-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
        }

        .selected-date {
            font-size: 16px;
            font-weight: 600;
            color: var(--tg-theme-button-color, #2481cc);
        }

        .actions {
            display: flex;
            gap: 12px;
        }

        .action-button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .cancel {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
        }

        .action-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="calendar">
        <div class="calendar-header">
            <button class="nav-button" onclick="changeMonth(-1)">‹</button>
            <div class="calendar-title" id="calendarTitle"></div>
            <button class="nav-button" onclick="changeMonth(1)">›</button>
        </div>

        <div class="week-days">
            <div class="week-day">Пн</div>
            <div class="week-day">Вт</div>
            <div class="week-day">Ср</div>
            <div class="week-day">Чт</div>
            <div class="week-day">Пт</div>
            <div class="week-day weekend">Сб</div>
            <div class="week-day weekend">Вс</div>
        </div>

        <div class="days-grid" id="daysGrid"></div>

        <div class="selected-info">
            Выбрана дата: <span class="selected-date" id="selectedDate">не выбрана</span>
        </div>

        <div class="actions">
            <button class="action-button cancel" onclick="cancelSelection()">Отмена</button>
            <button class="action-button confirm" onclick="confirmSelection()">Выбрать</button>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let selectedDate = null;

        const monthNames = [
            'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
            'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'
        ];

        // Инициализация Telegram Web App
        Telegram.WebApp.ready();

        function initCalendar() {
            updateCalendarTitle();
            renderCalendar();
            updateSelectedDateDisplay();
        }

        function updateCalendarTitle() {
            const title = document.getElementById('calendarTitle');
            title.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        }

        function renderCalendar() {
            const daysGrid = document.getElementById('daysGrid');
            daysGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            // Первый день месяца
            const firstDay = new Date(year, month, 1);
            // Последний день месяца
            const lastDay = new Date(year, month + 1, 0);
            // День недели первого дня (0 - воскресенье, 1 - понедельник, etc.)
            const firstDayWeekday = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

            const today = new Date();

            // Дни предыдущего месяца
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = firstDayWeekday - 1; i >= 0; i--) {
                const dayElement = createDayElement(prevMonthLastDay - i, 'other-month', false);
                daysGrid.appendChild(dayElement);
            }

            // Дни текущего месяца
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const date = new Date(year, month, i);
                const isToday = today.getDate() === i && today.getMonth() === month && today.getFullYear() === year;
                const isSelected = selectedDate &&
                    selectedDate.getDate() === i &&
                    selectedDate.getMonth() === month &&
                    selectedDate.getFullYear() === year;
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;

                let className = 'day';
                if (isToday) className += ' today';
                if (isSelected) className += ' selected';
                if (isWeekend) className += ' weekend';

                const dayElement = createDayElement(i, className, true, date);
                daysGrid.appendChild(dayElement);
            }

            // Дни следующего месяца
            const totalCells = 42; // 6 строк по 7 дней
            const remainingCells = totalCells - (firstDayWeekday + lastDay.getDate());
            for (let i = 1; i <= remainingCells; i++) {
                const dayElement = createDayElement(i, 'day other-month', false);
                daysGrid.appendChild(dayElement);
            }
        }

        function createDayElement(dayNumber, className, isClickable, date = null) {
            const day = document.createElement('div');
            day.className = className;
            day.textContent = dayNumber;

            if (isClickable && date) {
                day.onclick = () => selectDate(date);
            }

            return day;
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateCalendarTitle();
            renderCalendar();
        }

        function selectDate(date) {
            selectedDate = date;
            renderCalendar();
            updateSelectedDateDisplay();
        }

        function updateSelectedDateDisplay() {
            const selectedDateElement = document.getElementById('selectedDate');
            if (selectedDate) {
                const formattedDate = formatDate(selectedDate);
                selectedDateElement.textContent = formattedDate;
            } else {
                selectedDateElement.textContent = 'не выбрана';
            }
        }

        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }

        function confirmSelection() {
            if (selectedDate) {
                Telegram.WebApp.sendData(JSON.stringify({
                    date: formatDate(selectedDate),
                    timestamp: selectedDate.getTime(),
                    iso: selectedDate.toISOString()
                }));
            } else {
                alert('Пожалуйста, выберите дату');
            }
        }

        function cancelSelection() {
            Telegram.WebApp.close();
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', initCalendar);
    </script>
</body>
</html>